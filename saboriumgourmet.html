<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Saborium Gourmet ‚Äî Premium Selection</title>

  <!-- Montserrat for UI text -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /******************************************************************
     * Saborium Gourmet - Premium Food Store
     * Colores: Negro, dorado, crema, toques de verde oliva
     ******************************************************************/

    /* -------------------- Font for the logo (custom) -------------------- */
    @font-face {
      font-family: "BogartTrial";
      src: url("fuente_saborium.ttf") format("truetype");
      font-weight: 900;
      font-style: italic;
      font-display: swap;
    }

    /* -------------------- CSS RESET (light) -------------------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg, #f8f6f1 0%, #f0ede5 100%);
      color: #2a2622;
      font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height: 1.45;
      -webkit-tap-highlight-color: transparent;
      font-size: 15px;
    }

    /* -------------------- THEME VARIABLES (GOURMET) -------------------- */
    :root{
      --gold-1: #d4af37;
      --gold-2: #c19a2e;
      --cream-1: #faf8f3;
      --cream-2: #f5f2ea;
      --olive: #6b7c59;
      --dark: #1a1816;
      --muted: #5a5650;
      --card-bg: rgba(255,255,255,0.98);
      --glass: rgba(250,248,243,0.7);
      --shadow-soft: 0 10px 36px rgba(20,15,10,0.08);
      --shadow-strong: 0 30px 80px rgba(10,6,3,0.15);
      --radius-lg: 18px;
    }

    /* -------------------- PAGE LAYOUT -------------------- */
    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      padding: 22px 28px;
      max-width:1200px;
      margin: 18px auto;
    }

    /* Logo block */
    .brand {
      display:flex;
      flex-direction:column;
      gap:4px;
      user-select: none;
    }
    .brand .logo {
      font-family: "BogartTrial", "Montserrat", serif;
      color: var(--gold-1);
      font-size: 34px;
      font-weight: 900;
      font-style: italic;
      text-transform: lowercase;
      letter-spacing: 0.6px;
      line-height: 1;
      text-shadow: 0 2px 8px rgba(212,175,55,0.2);
    }
    .brand .by {
      display:inline-block;
      font-size: 12px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 999px;
      background: var(--dark);
      color: var(--gold-1);
      transform: translateY(-2px);
      box-shadow: 0 6px 22px rgba(0,0,0,0.2);
    }

    /* Top info strip */
    .top-info {
      margin: 0 auto;
      max-width: 1200px;
      padding: 8px 20px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(90deg, rgba(212,175,55,0.15), rgba(250,248,243,0.8));
      border-radius: 999px;
      border: 1px solid rgba(212,175,55,0.2);
      box-shadow: var(--shadow-soft);
      color: var(--muted);
      font-weight: 600;
      gap: 8px;
      margin-bottom: 14px;
    }

    /* Small nav area (right side of header) */
    .header-actions {
      display:flex;
      gap:12px;
      align-items:center;
    }
    .tagline {
      color: var(--muted);
      font-weight:600;
      font-size:13px;
      display:none;
    }

    /* -------------------- MAIN GRID -------------------- */
    .site {
      max-width: 1200px;
      margin: 0 auto 36px;
      padding: 0 28px;
    }

    @media (max-width: 980px){
      .site { padding: 0 20px; }
      .brand .logo { font-size: 28px; }
      header { padding: 16px 20px; }
    }

    /* -------------------- CONTENT (products area) -------------------- */
    .content {
      padding-top: 6px;
    }

    .intro {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 18px;
      margin-bottom: 18px;
      padding: 14px 16px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.95), var(--cream-1));
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(212,175,55,0.15);
    }
    .intro .left {
      max-width: 100%;
    }
    .intro h2 {
      color: var(--dark);
      font-size: 22px;
      margin-bottom: 6px;
    }
    .intro p {
      margin: 0;
      color: var(--muted);
      font-size: 15px;
    }

    /* Products grid - 3 productos por fila */
    .products-grid {
      margin-top: 18px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
    }
    @media (max-width: 980px) {
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 640px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
    }

    .product {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 14px;
      box-shadow: var(--shadow-soft);
      display:flex;
      flex-direction:column;
      gap:12px;
      transition: transform .26s cubic-bezier(.2,.9,.2,1), box-shadow .26s ease;
      border: 1px solid rgba(212,175,55,0.1);
    }
    .product:hover {
      transform: translateY(-8px);
      box-shadow: 0 28px 60px rgba(30,20,10,0.12);
    }

    .product .photo {
      width: 100%;
      height: 280px;
      border-radius: 12px;
      overflow:hidden;
      display:block;
      background: linear-gradient(180deg,rgba(212,175,55,0.05),var(--cream-2));
      position:relative;
    }
    .product .photo img {
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transition: transform .6s ease;
    }
    .product .photo:hover img { transform: scale(1.03); }

    .product h3 {
      font-size: 18px;
      color: var(--dark);
      margin: 0;
    }
    .product .desc {
      color: var(--muted);
      font-size: 13.5px;
      min-height: 42px;
    }
    .product .meta {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .price {
      font-weight:800;
      color: var(--gold-2);
    }

    .product .actions {
      display:flex;
      gap:10px;
      margin-top: 6px;
    }

    .btn {
      padding: 10px 14px;
      border-radius: 12px;
      border: none;
      font-weight:600;
      cursor: pointer;
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .btn:active { transform: translateY(1px); }

    .btn.ghost {
      background: transparent;
      color: var(--dark);
      border: 1px solid rgba(212,175,55,0.3);
    }
    .btn.ghost:hover {
      background: rgba(212,175,55,0.05);
    }
    .btn.primary {
      background: linear-gradient(180deg, var(--gold-1), var(--gold-2));
      color: var(--dark);
      box-shadow: 0 6px 20px rgba(212,175,55,0.25);
    }

    /* -------------------- SLIDE-IN CART -------------------- */
    .cart-toggle {
      position: fixed;
      right: 22px;
      top: 18px;
      z-index: 140;
      display:flex;
      gap:8px;
      align-items:center;
    }

    .cart-btn {
      background: linear-gradient(180deg,var(--gold-1),var(--gold-2));
      border-radius: 999px;
      padding: 12px 18px;
      font-weight:800;
      cursor:pointer;
      box-shadow: var(--shadow-soft);
      border: none;
      font-size: 16px;
      font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: var(--dark);
    }

    .cart-panel {
      position: fixed;
      right: -520px;
      top: 0;
      height: 100vh;
      width: 460px;
      background: linear-gradient(180deg, var(--cream-1), #fff);
      box-shadow: -40px 0 80px rgba(10,6,3,0.12);
      z-index: 200;
      transition: right .42s cubic-bezier(.2,.9,.2,1);
      padding: 26px;
      display:flex;
      flex-direction:column;
      gap:12px;
      font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    .cart-panel.open { right: 20px; }

    .cart-panel .head {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .cart-panel h3 { margin:0; color:var(--dark); font-size:20px; }
    .close-panel {
      background: var(--dark);
      color: var(--gold-1);
      border-radius: 10px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight:800;
    }

    .cart-items {
      flex:1;
      overflow:auto;
      padding-right:6px;
      margin-top:6px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .cart-item {
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      border: 1px solid rgba(212,175,55,0.15);
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:space-between;
    }
    .cart-item .info { min-width:0; }
    .cart-item .info .name { font-weight:700; color:var(--dark); font-size:14px; }
    .cart-item .qtyctrl { display:flex; gap:8px; align-items:center; }

    .cart-summary {
      border-top: 1px solid rgba(212,175,55,0.2);
      padding-top: 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    .cart-actions {
      display:flex;
      gap:10px;
      margin-top:8px;
    }

    /* -------------------- PRODUCT DETAIL MODAL -------------------- */
    .overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items:center;
      justify-content:center;
      z-index: 300;
      background: rgba(10,7,5,0.6);
      backdrop-filter: blur(4px) saturate(1.03);
      padding: 20px;
    }
    .overlay.active { display:flex; }

    .modal-card {
      width: min(920px, 96%);
      max-height: 92vh;
      overflow:auto;
      border-radius: 16px;
      background: linear-gradient(180deg,#fff,var(--cream-1));
      padding: 18px;
      box-shadow: var(--shadow-strong);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      position: relative;
    }
    @media (max-width:980px) { .modal-card { grid-template-columns: 1fr; } }

    .modal-photo { border-radius: 12px; overflow:hidden; height:100%; min-height:280px; }
    .modal-photo img { width:100%; height:100%; object-fit:cover; display:block; }

    .modal-info { padding:4px 6px; display:flex; flex-direction:column; gap:10px; }
    .modal-info h3 { margin:0; color:var(--dark); }
    .modal-info p { margin:0; color:var(--muted); font-size:14px; line-height:1.45; }

    .modal-info .meta-box {
      background: var(--cream-2);
      border-radius: 10px;
      padding: 10px;
      border: 1px solid rgba(212,175,55,0.1);
      color: var(--muted);
      font-size: 13px;
    }

    .modal-close {
      position:absolute;
      right:12px;
      top:12px;
      width:44px;
      height:44px;
      border-radius:999px;
      background: var(--dark);
      color:var(--gold-1);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 28px rgba(0,0,0,0.2);
    }

    /* -------------------- CHECKOUT FORM MODAL -------------------- */
    .form-overlay { position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index: 320; background: rgba(7,4,2,0.6); padding:20px; }
    .form-overlay.active { display:flex; }

    .checkout-form {
      width: 820px;
      max-width: 98%;
      border-radius: 12px;
      background: var(--card-bg);
      padding: 22px;
      box-shadow: var(--shadow-strong);
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
      font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      font-size: 16px;
    }
    @media (max-width:980px) { .checkout-form { grid-template-columns: 1fr; } }

    .checkout-left { display:flex; flex-direction:column; gap:12px; }
    .checkout-right { background: linear-gradient(180deg,#fff,var(--cream-1)); padding:14px; border-radius:12px; border:1px solid rgba(212,175,55,0.15); }

    label { font-size:15px; color: var(--muted); font-weight:700; display:block; margin-bottom:6px; }
    input[type="text"], input[type="email"], input[type="tel"], textarea, select {
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(212,175,55,0.2);
      font-size:15px;
      outline:none;
      background:white;
      font-family: "Montserrat", sans-serif;
    }
    textarea { min-height:110px; resize:vertical; font-size:15px; padding:12px; }

    .address-animate {
      max-height:0;
      opacity:0;
      transform: translateY(-8px);
      overflow:hidden;
      transition: all .42s cubic-bezier(.2,.9,.2,1);
    }
    .address-animate.open {
      max-height:240px;
      opacity:1;
      transform: translateY(0);
    }

    .form-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:8px; }

    /* Gift toggle */
    .switch {
      display:inline-flex;
      align-items:center;
      gap:10px;
      user-select:none;
      margin-top:6px;
      cursor: pointer;
    }
    .switch .label { font-weight:700; color:var(--muted); }
    .switch-track {
      width:46px;
      height:26px;
      background: #e8e8ea;
      border-radius:999px;
      position:relative;
      transition: background .18s ease;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.04);
      cursor: pointer;
    }
    .switch-thumb {
      width:20px;
      height:20px;
      background:#fff;
      border-radius:50%;
      position:absolute;
      top:3px;
      left:3px;
      transition: left .18s cubic-bezier(.2,.9,.2,1), background .18s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      pointer-events: none;
    }
    .switch input[type="checkbox"] { display:none; }
    .switch input[type="checkbox"]:checked ~ .switch-track { background: linear-gradient(90deg,var(--gold-1),var(--gold-2)); }
    .switch input[type="checkbox"]:checked ~ .switch-track .switch-thumb { left:23px; }

    /* -------------------- FOOTER -------------------- */
    footer {
      max-width:1200px;
      margin: 40px auto 80px;
      padding: 18px 28px;
      text-align:center;
      color: var(--muted);
    }
    footer .legal { margin-top:8px; font-size:13px; color:var(--gold-2); }

    /* -------------------- HELPERS -------------------- */
    .muted { color: var(--muted); }
    .small { font-size:12px; color:var(--muted); }

    html { scroll-behavior: smooth; }
  </style>
</head>
<body>

  <header>
    <div class="brand" aria-hidden="true">
      <div class="logo">saborium gourmet</div>
      <div class="by">by saborium.</div>
    </div>

    <div class="header-actions" role="navigation" aria-label="Acciones principales">
      <div class="tagline">Gourmet ¬∑ Premium</div>
      <div class="cart-toggle" style="position:relative;">
        <button id="openCartTop" class="cart-btn" aria-controls="cartPanel" aria-expanded="false" title="Abrir cesta">
          üõí Cesta <span id="topCartCount" style="margin-left:10px;font-weight:800;color:var(--dark)">0</span>
        </button>
      </div>
    </div>
  </header>

  <div class="top-info" role="status" aria-live="polite">
    Temporada Navidad ¬∑ Productos Artesanales ¬∑ Reservas desde 1 de diciembre
  </div>

  <div class="site" role="main" aria-label="Cat√°logo y Cesta">
    <section class="content" aria-labelledby="catalogTitle">
      <div class="intro" role="region" aria-label="Introducci√≥n">
        <div class="left">
          <h2 id="catalogTitle">Saborium Gourmet ‚Äî Selecci√≥n Premium</h2>
          <p>Explora nuestra selecci√≥n de productos artesanales. Pulsa "Ver m√°s" para detalles, ingredientes y al√©rgenos. A√±ade a la cesta y finaliza con el formulario.</p>
        </div>
      </div>

      <div class="products-grid" id="productsGrid" aria-live="polite">
        <!-- Products rendered via JavaScript -->
      </div>
    </section>
  </div>

  <div id="cartPanel" class="cart-panel" role="dialog" aria-hidden="true" aria-label="Cesta de compra">
    <div class="head">
      <h3>Tu pedido üçΩÔ∏è</h3>
      <button class="close-panel" id="closeCartPanel" aria-label="Cerrar cesta">‚úï</button>
    </div>

    <div class="cart-items" id="cartItems" aria-live="polite">
      <div style="color:var(--muted)">Tu cesta est√° vac√≠a. A√±ade tus favoritos.</div>
    </div>

    <div class="cart-summary">
      <div class="small muted">Total</div>
      <div id="cartTotal" style="font-weight:800;color:var(--gold-2)">0.00 ‚Ç¨</div>
    </div>

    <div class="cart-actions">
      <button class="btn ghost" id="clearCartBtn">Vaciar cesta</button>
      <button class="btn primary" id="openCheckoutBtn">Hacer pedido</button>
    </div>

    <div style="margin-top:12px;font-size:12px;color:var(--muted);">
      M√©todos de pago √∫nicos aceptados: Efectivo con antelaci√≥n o Bizum al <strong>644677582</strong>.
    </div>
  </div>

  <div id="productOverlay" class="overlay" aria-hidden="true">
    <div class="modal-card" role="document" aria-labelledby="modalTitle">
      <div class="modal-photo">
        <img id="modalImage" src="" alt="Foto del producto">
      </div>
      <div class="modal-info">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <h3 id="modalTitle">T√≠tulo del producto</h3>
          <div class="modal-close" id="modalCloseBtn" aria-label="Cerrar detalle">‚úï</div>
        </div>
        <p id="modalShort" style="color:var(--muted);font-size:14px;">Breve descripci√≥n...</p>

        <div style="margin-top:6px;">
          <div class="meta-box">
            <strong>Descripci√≥n completa</strong>
            <p id="modalLong" style="margin-top:8px;color:var(--muted);">Texto largo del producto...</p>
          </div>

          <div style="display:flex;gap:8px;margin-top:10px;">
            <div style="flex:1">
              <strong>Ingredientes</strong>
              <p id="modalIngredients" style="color:var(--muted);margin-top:6px;">(Ingredientes)</p>
            </div>
            <div style="flex:1">
              <strong>Al√©rgenos</strong>
              <p id="modalAllergens" style="color:var(--muted);margin-top:6px;">(Al√©rgenos)</p>
            </div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:10px;">
          <button class="btn primary" id="modalAddBtn">A√±adir a la cesta</button>
          <button class="btn ghost" id="modalCloseBtn2">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <div id="checkoutOverlay" class="form-overlay" aria-hidden="true">
    <div class="checkout-form" role="form" aria-labelledby="checkoutTitle">
      <div class="checkout-left">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <h3 id="checkoutTitle" style="margin:0;color:var(--dark)">Finalizar pedido</h3>
          <div style="font-size:14px;color:var(--muted)">Rellena los datos para preparar tu pedido</div>
        </div>

        <div style="margin-top:6px;">
          <label for="custName">Nombre completo (obligatorio)</label>
          <input id="custName" type="text" placeholder="Ej. Ana P√©rez" autocomplete="name" required>
        </div>

        <div style="display:flex;gap:12px;margin-top:8px;">
          <div style="flex:1;">
            <label for="deliveryType">Recogida / Env√≠o</label>
            <select id="deliveryType" aria-controls="addressBlock">
              <option value="pickup">Recoger en Olalde Kalea</option>
              <option value="delivery">Env√≠o a domicilio (+3.00‚Ç¨)</option>
            </select>
          </div>
          <div style="flex:1;">
            <label for="emailField">Correo electr√≥nico (obligatorio)</label>
            <input id="emailField" type="email" placeholder="correo@ejemplo.com" autocomplete="email" required>
          </div>
        </div>

        <div id="addressBlock" class="address-animate" aria-hidden="true" style="margin-top:10px;">
          <label for="addressField">Direcci√≥n de env√≠o (obligatorio si elegiste env√≠o)</label>
          <input id="addressField" type="text" placeholder="Calle, n√∫mero, piso, ciudad..." autocomplete="street-address">
        </div>

        <div style="margin-top:8px;display:flex;gap:12px;">
          <div style="flex:1;">
            <label for="phoneField">Tel√©fono (obligatorio)</label>
            <input id="phoneField" type="tel" placeholder="600 000 000" autocomplete="tel">
          </div>
          <div style="flex:1;">
            <label for="discountField">C√≥digo descuento (opcional)</label>
            <input id="discountField" type="text" placeholder="CUPON123">
          </div>
        </div>

        <div style="margin-top:10px;">
          <label for="noteField">Nota (opcional)</label>
          <textarea id="noteField" placeholder="Algo que debamos saber (al√©rgenos, packaging, fecha)..."></textarea>
        </div>

        <div style="margin-top:8px;display:flex;align-items:center;justify-content:flex-start;gap:12px;">
          <label class="switch" for="giftToggle" style="align-items:center;">
            <input id="giftToggle" type="checkbox" />
            <div class="switch-track" aria-hidden="true">
              <div class="switch-thumb"></div>
            </div>
            <div style="margin-left:8px;">
              <div style="font-weight:700;color:var(--muted)">¬øLo quieres para regalo?</div>
              <div style="font-size:13px;color:var(--muted)">Si activas, +4.00 ‚Ç¨ (embalaje premium)</div>
            </div>
          </label>
        </div>

        <div style="margin-top:12px;display:flex;gap:12px;justify-content:flex-end;">
          <button class="btn ghost" id="closeCheckoutBtn">Volver</button>
          <button class="btn primary" id="confirmCheckoutBtn">Confirmar y copiar pedido</button>
        </div>
      </div>

      <aside class="checkout-right" aria-hidden="false">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <div style="font-weight:800;color:var(--dark)">Resumen</div>
          <div id="checkoutMiniTotal" style="font-weight:800;color:var(--gold-2)">0.00 ‚Ç¨</div>
        </div>

        <div id="checkoutItems" style="margin-top:12px;display:flex;flex-direction:column;gap:8px;max-height:52vh;overflow:auto;padding-right:6px;">
          <!-- dynamic cart summary -->
        </div>

        <div style="margin-top:12px;font-size:13px;color:var(--muted)">
          <strong>M√©todos de pago √∫nicos aceptados:</strong><br> Efectivo con antelaci√≥n o Bizum al <strong>644677582</strong>.
        </div>
      </aside>
    </div>
  </div>

  <footer>
    <div style="font-weight:800;color:var(--dark)">Saborium Gourmet by Saborium.</div>
    <div style="margin-top:6px;color:var(--muted);font-size:13px">¬© 2025 Todos los derechos reservados.</div>
    <div class="legal" style="margin-top:8px;">
      <a href="#" style="color:var(--gold-2)">Condiciones de servicio</a> ¬∑ <a href="#" style="color:var(--gold-2)">Pol√≠tica de privacidad</a>
    </div>
  </footer>

  <script>
    /**************************************************************************
     * Saborium Gourmet - Client logic
     * 9 productos gourmet (incluye Sorpresa y El√≠gelo t√∫)
     **************************************************************************/

    /* -------------------- PRODUCTS DATA (9 productos gourmet) -------------------- */
    const products = [
      {
        id: 'p1',
        name: 'Pat√© de Foie Artesanal',
        short: 'Pat√© de h√≠gado de pato con trufa negra y co√±ac.',
        long: 'Elaborado siguiendo m√©todos tradicionales franceses, nuestro pat√© combina h√≠gado de pato de primera calidad con trufa negra de Teruel y un toque de co√±ac a√±ejo. Textura sedosa y sabor profundo.',
        ingredients: 'H√≠gado de pato, trufa negra, co√±ac, mantequilla, especias.',
        allergens: 'Contiene: l√°cteos, alcohol.',
        price: 18.50,
        img: 'https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p2',
        name: 'Aceite de Oliva Virgen Extra',
        short: 'AOVE de variedad arbequina, primera prensada en fr√≠o.',
        long: 'Aceite de oliva virgen extra procedente de olivares centenarios. Prensado en fr√≠o para preservar todas sus propiedades organol√©pticas. Sabor afrutado con toques de almendra.',
        ingredients: 'Aceitunas arbequina 100%.',
        allergens: 'Sin al√©rgenos.',
        price: 12.90,
        img: 'https://images.unsplash.com/photo-1474979266404-7eaacbcd87c5?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p3',
        name: 'Queso Manchego Curado',
        short: 'Queso manchego D.O.P. con 12 meses de curaci√≥n.',
        long: 'Elaborado con leche cruda de oveja manchega, este queso ha sido curado durante 12 meses en condiciones √≥ptimas. Textura firme y sabor intenso con matices dulces.',
        ingredients: 'Leche cruda de oveja, sal, cuajo, fermentos l√°cticos.',
        allergens: 'Contiene: l√°cteos.',
        price: 24.80,
        img: 'https://images.unsplash.com/photo-1452195100486-9cc805987862?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p4',
        name: 'Jam√≥n Ib√©rico de Bellota',
        short: 'Jam√≥n ib√©rico 100% bellota con D.O. Guijuelo.',
        long: 'Pieza de jam√≥n ib√©rico de cerdos criados en libertad alimentados exclusivamente con bellotas. Curaci√≥n m√≠nima de 36 meses. Sabor √∫nico, intenso y persistente.',
        ingredients: 'Jam√≥n de cerdo ib√©rico, sal marina.',
        allergens: 'Sin al√©rgenos declarados.',
        price: 89.00,
        img: 'https://images.unsplash.com/photo-1606908628397-d84fbd29ab89?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p5',
        name: 'Caviar de Esturi√≥n',
        short: 'Caviar imperial de esturi√≥n ruso, lata de 50g.',
        long: 'Huevas de esturi√≥n seleccionadas, saladas con m√©todo tradicional Malossol. Color dorado intenso, textura cremosa y sabor delicado con toques marinos.',
        ingredients: 'Huevas de esturi√≥n, sal.',
        allergens: 'Contiene: pescado.',
        price: 125.00,
        img: 'https://images.unsplash.com/photo-1535473895227-bdecb20fb157?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p6',
        name: 'Sal de Escamas Maldon',
        short: 'Sal marina en escamas de Essex, Inglaterra.',
        long: 'Sal marina obtenida mediante evaporaci√≥n lenta de agua del estuario de Blackwater. Cristales piramidales √∫nicos, textura crujiente y sabor puro sin amargor.',
        ingredients: 'Sal marina.',
        allergens: 'Sin al√©rgenos.',
        price: 8.50,
        img: 'https://images.unsplash.com/photo-1586444248902-2f64eddc13df?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p7',
        name: 'Vinagre Bals√°mico de M√≥dena',
        short: 'Aceto Balsamico Tradizionale di Modena DOP, 25 a√±os.',
        long: 'Vinagre bals√°mico tradicional envejecido durante 25 a√±os en barricas de diferentes maderas. Densidad perfecta, acidez equilibrada y complejidad arom√°tica excepcional.',
        ingredients: 'Mosto de uva cocido.',
        allergens: 'Contiene: sulfitos.',
        price: 45.00,
        img: 'https://images.unsplash.com/photo-1474943997877-1a93ca1b26fd?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p_elige',
        name: 'El√≠gelo t√∫',
        short: 'Dinos en la nota qu√© producto gourmet buscas y lo conseguiremos.',
        long: 'Elige esta opci√≥n si tienes una petici√≥n espec√≠fica: indica en la nota el producto que buscas (por ejemplo: "Foie micuit de oca 200g" o "Trufa blanca de Alba 30g"). Haremos todo lo posible por conseguirlo.',
        ingredients: '',
        allergens: '',
        price: 0.00,
        img: 'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?auto=format&fit=crop&w=1200&q=80'
      },
      {
        id: 'p_surprise',
        name: 'Sorpresa Gourmet',
        short: '¬øNo sabes qu√© elegir? D√©jate sorprender por nuestra selecci√≥n.',
        long: 'Seleccionaremos uno de nuestros productos estrella para ti. Si tienes preferencias, especif√≠calas en la nota al finalizar.',
        ingredients: '',
        allergens: '',
        price: 0.00,
        img: 'https://images.unsplash.com/photo-1481487196290-c152efe083f5?auto=format&fit=crop&w=1200&q=80'
      }
    ];

    /* -------------------- RENDER PRODUCTS -------------------- */
    const productsGrid = document.getElementById('productsGrid');

    function renderProducts(){
      productsGrid.innerHTML = '';
      for(const p of products){
        const card = document.createElement('article');
        card.className = 'product';
        card.setAttribute('data-id', p.id);
        card.innerHTML = `
          <div class="photo" aria-hidden="true">
            <img src="${p.img}" alt="${escapeHtml(p.name)}">
          </div>
          <h3>${escapeHtml(p.name)}</h3>
          <div class="desc">${escapeHtml(p.short)}</div>
          <div class="meta">
            <div class="price">${p.price.toFixed(2)} ‚Ç¨</div>
          </div>
          <div class="actions">
            <button class="btn ghost" data-action="view" data-id="${p.id}">Ver m√°s</button>
            <button class="btn primary" data-action="add" data-id="${p.id}">A√±adir a la cesta</button>
          </div>
        `;
        productsGrid.appendChild(card);
      }
    }

    function escapeHtml(text){
      return String(text || '').replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
    }

    /* -------------------- CART STATE -------------------- */
    let cart = {};

    function getCartCount(){
      return Object.values(cart).reduce((s,q)=>s+q,0);
    }

    function computeSubtotal(){
      return Object.entries(cart).reduce((s,[id,q]) => {
        const p = products.find(x=>x.id===id);
        const price = p ? p.price : 0;
        return s + price * q;
      }, 0);
    }

    /* -------------------- UI ELEMENTS -------------------- */
    const topCartCount = document.getElementById('topCartCount');
    const cartPanel = document.getElementById('cartPanel');
    const cartItemsEl = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');

    /* -------------------- RENDER CART -------------------- */
    function renderCartUI(){
      topCartCount.textContent = getCartCount();

      cartItemsEl.innerHTML = '';
      const entries = Object.entries(cart);
      if(entries.length === 0){
        cartItemsEl.innerHTML = '<div style="color:var(--muted)">Tu cesta est√° vac√≠a. A√±ade tus favoritos.</div>';
      } else {
        for(const [id,qty] of entries){
          const p = products.find(x=>x.id===id);
          const item = document.createElement('div');
          item.className = 'cart-item';
          item.innerHTML = `
            <div style="display:flex;gap:10px;align-items:center;">
              <div style="width:64px;height:48px;border-radius:8px;overflow:hidden;background:var(--cream-2)"><img src="${p.img}" alt="${escapeHtml(p.name)}" style="width:100%;height:100%;object-fit:cover;display:block"></div>
              <div class="info">
                <div class="name">${escapeHtml(p.name)}</div>
                <div class="small muted">${p.price.toFixed(2)} ‚Ç¨</div>
              </div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px;">
              <div class="qtyctrl">
                <button class="small-btn" data-action="dec" data-id="${p.id}">‚àí</button>
                <div style="min-width:28px;text-align:center;font-weight:700">${qty}</div>
                <button class="small-btn" data-action="inc" data-id="${p.id}">+</button>
              </div>
              <div style="color:var(--gold-2);font-weight:700">${(p.price * qty).toFixed(2)} ‚Ç¨</div>
            </div>
          `;
          cartItemsEl.appendChild(item);
        }
      }

      const subtotal = computeSubtotal();
      cartTotalEl.textContent = subtotal.toFixed(2) + ' ‚Ç¨';
    }

    /* -------------------- CART OPERATIONS -------------------- */
    function addToCart(productId, qty = 1){
      if(!cart[productId]) cart[productId] = 0;
      cart[productId] += qty;
      renderCartUI();
      flashProduct(productId);
    }

    function changeQty(productId, newQty){
      if(newQty <= 0) delete cart[productId];
      else cart[productId] = newQty;
      renderCartUI();
    }

    function clearCart(){
      cart = {};
      renderCartUI();
    }

    function flashProduct(productId){
      const el = document.querySelector(`[data-id="${productId}"]`);
      if(!el) return;
      el.animate([{transform:'scale(1)'},{transform:'scale(1.025)'},{transform:'scale(1)'}], {duration:260, easing:'ease-out'});
    }

    /* -------------------- EVENT DELEGATION -------------------- */
    productsGrid.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-action]');
      if(!btn) return;
      const action = btn.getAttribute('data-action');
      const id = btn.getAttribute('data-id');
      if(action === 'add') {
        if(id === 'p_surprise'){
          addSurprise();
        } else if(id === 'p_elige'){
          if(!cart[id]) cart[id]=0;
          cart[id] += 1;
          alert('Has a√±adido "El√≠gelo t√∫". Especifica en la nota lo que buscas.');
          renderCartUI();
        } else addToCart(id);
      }
      if(action === 'view') openProductModal(id);
    });

    /* -------------------- CART PANEL TOGGLING -------------------- */
    const openCartTop = document.getElementById('openCartTop');
    const closeCartPanel = document.getElementById('closeCartPanel');

    openCartTop.addEventListener('click', ()=>{
      const open = cartPanel.classList.toggle('open');
      openCartTop.setAttribute('aria-expanded', open ? 'true' : 'false');
      if(open) cartPanel.focus();
    });
    closeCartPanel.addEventListener('click', ()=> {
      cartPanel.classList.remove('open');
      openCartTop.setAttribute('aria-expanded', 'false');
    });

    cartItemsEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-action]');
      if(!btn) return;
      e.stopPropagation();
      const action = btn.getAttribute('data-action');
      const id = btn.getAttribute('data-id');
      if(action === 'dec') changeQty(id, (cart[id] || 0) - 1);
      if(action === 'inc') changeQty(id, (cart[id] || 0) + 1);
    });

    document.getElementById('clearCartBtn').addEventListener('click', ()=>{
      clearCart();
    });

    document.getElementById('openCheckoutBtn').addEventListener('click', openCheckoutForm);

    /* -------------------- PRODUCT DETAIL MODAL -------------------- */
    const productOverlay = document.getElementById('productOverlay');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalShort = document.getElementById('modalShort');
    const modalLong = document.getElementById('modalLong');
    const modalIngredients = document.getElementById('modalIngredients');
    const modalAllergens = document.getElementById('modalAllergens');
    const modalAddBtnEl = document.getElementById('modalAddBtn');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const modalCloseBtn2 = document.getElementById('modalCloseBtn2');

    let currentModalProductId = null;

    function openProductModal(id){
      const p = products.find(x=>x.id===id);
      if(!p) return;
      currentModalProductId = id;
      modalImage.src = p.img;
      modalTitle.textContent = p.name;
      modalShort.textContent = p.short;
      modalLong.textContent = p.long;
      modalIngredients.textContent = p.ingredients || '-';
      modalAllergens.textContent = p.allergens || '-';
      productOverlay.classList.add('active');
      productOverlay.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
      modalAddBtnEl.onclick = ()=> {
        if(id === 'p_surprise') { addSurprise(); }
        else if(id === 'p_elige') {
          if(!cart[id]) cart[id] = 0;
          cart[id] += 1;
          alert('Has a√±adido "El√≠gelo t√∫". No olvides detallar lo que buscas en la nota.');
          renderCartUI();
        } else addToCart(id);
        closeProductModal();
      };
    }

    function closeProductModal(){
      productOverlay.classList.remove('active');
      productOverlay.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      currentModalProductId = null;
    }

    modalCloseBtn.addEventListener('click', closeProductModal);
    modalCloseBtn2.addEventListener('click', closeProductModal);

    productOverlay.addEventListener('click', (e)=>{
      if(e.target === productOverlay) closeProductModal();
    });

    /* -------------------- CHECKOUT FORM -------------------- */
    const checkoutOverlay = document.getElementById('checkoutOverlay');
    const deliveryType = document.getElementById('deliveryType');
    const addressBlock = document.getElementById('addressBlock');
    const closeCheckoutBtn = document.getElementById('closeCheckoutBtn');
    const confirmCheckoutBtn = document.getElementById('confirmCheckoutBtn');
    const giftToggle = document.getElementById('giftToggle');

    function openCheckoutForm(){
      if(Object.keys(cart).length === 0){
        alert('Tu cesta est√° vac√≠a. A√±ade algo antes de hacer un pedido.');
        return;
      }
      renderCheckoutSummary();
      checkoutOverlay.classList.add('active');
      checkoutOverlay.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }

    function closeCheckout(){
      checkoutOverlay.classList.remove('active');
      checkoutOverlay.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
    closeCheckoutBtn.addEventListener('click', closeCheckout);

    deliveryType.addEventListener('change', (e)=>{
      if(e.target.value === 'delivery'){
        addressBlock.classList.add('open');
        addressBlock.setAttribute('aria-hidden','false');
      } else {
        addressBlock.classList.remove('open');
        addressBlock.setAttribute('aria-hidden','true');
      }
    });

    function renderCheckoutSummary(){
      const container = document.getElementById('checkoutItems');
      container.innerHTML = '';
      const entries = Object.entries(cart);
      if(entries.length===0){
        container.innerHTML = '<div style="color:var(--muted)">No hay items.</div>';
      } else {
        for(const [id, qty] of entries){
          const p = products.find(x=>x.id===id);
          const row = document.createElement('div');
          row.style.display = 'flex';
          row.style.justifyContent = 'space-between';
          row.style.alignItems = 'center';
          row.style.gap = '10px';
          row.innerHTML = `<div style="min-width:0"><div style="font-weight:700">${escapeHtml(p.name)}</div><div style="color:var(--muted);font-size:13px">${qty} √ó ${p.price.toFixed(2)} ‚Ç¨</div></div><div style="font-weight:700;color:var(--gold-2)">${(p.price * qty).toFixed(2)} ‚Ç¨</div>`;
          container.appendChild(row);
        }
      }
      const subtotal = computeSubtotal();
      const deliveryCharge = (deliveryType.value === 'delivery') ? 3.00 : 0.00;
      const giftCharge = giftToggle.checked ? 4.00 : 0.00;
      const total = (subtotal + deliveryCharge + giftCharge).toFixed(2);
      document.getElementById('checkoutMiniTotal').textContent = total + ' ‚Ç¨';
    }

    giftToggle.addEventListener('change', ()=> {
      renderCheckoutSummary();
    });

    /* -------------------- CONFIRM CHECKOUT -------------------- */
    confirmCheckoutBtn.addEventListener('click', async ()=> {
      const name = document.getElementById('custName').value.trim();
      const email = document.getElementById('emailField').value.trim();
      const phone = document.getElementById('phoneField').value.trim();
      const method = deliveryType.value;
      const address = document.getElementById('addressField').value.trim();
      const note = document.getElementById('noteField').value.trim();
      const discount = document.getElementById('discountField').value.trim();
      const gift = giftToggle.checked;

      if(!name){ alert('Por favor indica tu nombre.'); document.getElementById('custName').focus(); return; }
      if(!validateEmail(email)){ alert('Por favor indica un correo v√°lido.'); document.getElementById('emailField').focus(); return; }
      if(!phone){ alert('Por favor indica un tel√©fono.'); document.getElementById('phoneField').focus(); return; }
      if(method === 'delivery' && !address){ alert('Has seleccionado env√≠o a domicilio; por favor indica la direcci√≥n.'); document.getElementById('addressField').focus(); return; }

      const entries = Object.entries(cart);
      let itemsText = '';
      if(entries.length === 0) itemsText = '--- SIN ITEMS EN LA CESTA ---';
      else {
        itemsText = entries.map(([id,q]) => {
          const p = products.find(x=>x.id===id);
          return `- ${p.name} x${q} (precio unitario: ${p.price.toFixed(2)} ‚Ç¨)`;
        }).join('\n');
      }

      const deliveryCharge = (method === 'delivery') ? 3.00 : 0.00;
      const subtotal = computeSubtotal();
      const giftCharge = gift ? 4.00 : 0.00;
      const total = (subtotal + deliveryCharge + giftCharge).toFixed(2);

      const orderText = `SABORIUM GOURMET - Pedido autom√°tico

Nombre: ${name}
Recogida/Env√≠o: ${method === 'pickup' ? 'Recoger en Olalde Kalea' : 'Env√≠o a domicilio (+3.00‚Ç¨)'}
Direcci√≥n: ${method === 'delivery' ? address : 'Olalde Kalea'}
Email: ${email}
Tel√©fono: ${phone}

Productos:
${itemsText}

Nota cliente: ${note}
C√≥digo descuento: ${discount}
¬øRegalo?: ${gift ? 'S√≠ (+4.00 ‚Ç¨) ‚Äî embalaje premium' : 'No'}

Subtotal: ${subtotal.toFixed(2)} ‚Ç¨
Gastos env√≠o: ${deliveryCharge.toFixed(2)} ‚Ç¨
Gastos regalo: ${giftCharge.toFixed(2)} ‚Ç¨
TOTAL: ${total} ‚Ç¨

M√©todos de pago √∫nicos aceptados: Efectivo con antelaci√≥n o Bizum al 644677582

(Se recomienda pegar este texto en el formulario de Google Forms con CTRL+V / pegar)
`;

      try {
        await navigator.clipboard.writeText(orderText);
        alert('Tu pedido se ha copiado al portapapeles. Ser√°s redirigido al formulario de pedido.');
      } catch (err) {
        prompt('No se pudo copiar autom√°ticamente. Selecciona y copia este texto (Ctrl+C):', orderText);
      }

      const googleFormURL = 'https://forms.gle/oki3BCVzU2yM1V276';
      setTimeout(()=> { window.location.href = googleFormURL; }, 800);
    });

    /* -------------------- UTIL -------------------- */
    function validateEmail(email){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        if(productOverlay.classList.contains('active')) closeProductModal();
        if(checkoutOverlay.classList.contains('active')) closeCheckout();
      }
    });

    /* -------------------- INIT -------------------- */
    renderProducts();
    renderCartUI();

    document.getElementById('openCartTop').addEventListener('click', ()=>{
      cartPanel.classList.add('open');
      document.getElementById('openCartTop').setAttribute('aria-expanded', 'true');
    });

    document.addEventListener('click', (e)=>{
      const insidePanel = e.target.closest('#cartPanel');
      const clickedOpenBtn = e.target.closest('#openCartTop');
      const clickedCartBtn = e.target.closest('.cart-item button');
      if(!insidePanel && !clickedOpenBtn && !clickedCartBtn && cartPanel.classList.contains('open')){
        cartPanel.classList.remove('open');
        document.getElementById('openCartTop').setAttribute('aria-expanded', 'false');
      }
    });

    function addSurprise(){
      const candidates = products.filter(p => p.id !== 'p_surprise' && p.id !== 'p_elige');
      const pick = candidates[Math.floor(Math.random()*candidates.length)];
      addToCart(pick.id);
      alert(`Te hemos a√±adido: ${pick.name} (opci√≥n "Sorpresa"). Puedes a√±adir m√°s o finalizar el pedido.`);
    }

    (function initAddressBlock(){
      if(deliveryType.value === 'delivery'){
        addressBlock.classList.add('open');
        addressBlock.setAttribute('aria-hidden','false');
      } else {
        addressBlock.classList.remove('open');
        addressBlock.setAttribute('aria-hidden','true');
      }
    })();
  </script>
</body>
</html>
